Refesh counter: <span id="counter">Counter</span> times
<h3>List services</h3>
<div id="list">Loading ...</div>
<h3>Information</h3>
<div id="content">Loading ...</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
<script src="scripts/jquery-1.3.2.debug.js" type="text/javascript"></script>
<script src="scripts/json.debug.js" type="text/javascript"></script>

<link href="default.css" rel="stylesheet" type="text/css" />

<script type="text/javascript">

window.onerror=function(msg, url, linenumber){
 alert('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber)
 return true
}
</script>


<script type="text/javascript">

function getURLParameter(name) {
	return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
}

var salsaCenterHost="http://134.158.75.65:8080";
var salsaCenterHostLocal="http://localhost:8080";


//var dataSource=salsaCenterHostLocal.concat("/salsa-center-services/rest/getservicejson/").concat(getURLParameter('id'));
//var listSource=salsaCenterHostLocal.concat("/salsa-center-services/rest/getservicejsonlist");
var dataSource="rest/getservicejson/"+getURLParameter('id');
var listSource="rest/getservicejsonlist";
// var dataSource="example.json";
// var listSource="examplelist.json";


var refeshCount=0;

$.ajaxSetup({
    cache: false
});

function handleJson() {
  $.getJSON(dataSource,
  function(json){ 
 
  	$('#content').html(CreateTableViewSalsaNodes(json.nodes)).fadeIn();
  	refeshCount+=1;
  	$('#counter').text(refeshCount).fadeIn();
  	
  	setTimeout(function(){
  		handleJson();
    }, 1000);
  	
  });
}

handleJson();

$.getJSON(listSource,  function(json){ 
	$('#list').html(createListTable(json.services)).fadeIn();
});


function CreateTableViewSalsaNodes(data) {
    
    var str = '<table class="lightPro">';
      str += '<thead><tr>';
     for (var index in data[0]) {
         str += '<th scope="col">' + index + '</th>';
     }
     str += '</tr></thead>';
    
     // table body
    str += '<tbody>';
    for (var i = 0; i < data.length; i++) {
        str += (i % 2 == 0) ? '<tr class="alt">' : '<tr>';
        str += '<td>' + data[i].id + '</td>';
        str += '<td>' + data[i].state + '</td>';
        str += '<td>' + data[i].type + '</td>';
        str += '<td>';
        var arrayCapa=data[i].capability;
        //str+=arrayCapa.toString();
        for (var j=0; j<arrayCapa.length; j++){
        	str += arrayCapa[j].capaId+":"+arrayCapa[j].value+"; ";
        }
        
        str+='</td>';
        str += '</tr>';        
    }
        
    str += '</tbody>'
    str += '</table>';
    return str;
}

function createListTable(data){
	 var str = '<table class="lightPro">';
	 var currentURL= [location.protocol, '//', location.host, location.pathname].join('');
     str += '<thead><tr>';
    for (var index in data[0]) {
        str += '<th scope="col">' + index + '</th>';
    }
    str += '</tr></thead>';
   
    // table body
   str += '<tbody>';
   for (var i = 0; i < data.length; i++) {
          str += (i % 2 == 0) ? '<tr class="alt">' : '<tr>';
          str += '<td><a href="'+currentURL+'?id='+data[i].serviceId+'">' + data[i].serviceId + '</a></td>';
          str += '<td>' + data[i].deployTime + '</td>';
          str += '</tr>';
         
       }
   
       
   str += '</tbody>'
   str += '</table>';
   return str;
	
}

</script>


