Refesh counter: <span id="counter">Counter</span> times
<h3>List services</h3>
<div id="list">Loading ...</div>
<h3>Information</h3>
<div id="content">Loading ...</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
<script src="scripts/jquery-1.3.2.debug.js" type="text/javascript"></script>
<script src="scripts/json.debug.js" type="text/javascript"></script>

<link href="default.css" rel="stylesheet" type="text/css" />

<script type="text/javascript">

window.onerror=function(msg, url, linenumber){
 alert('Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber)
 return true
}
</script>


<script type="text/javascript">

function getURLParameter(name) {
	return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
}

var salsaCenterHost="http://134.158.75.65:8080";
var salsaCenterHostLocal="http://localhost:8080";


var dataSource="rest/getserviceruntimexml/"+getURLParameter('id');
var listSource="rest/getservicejsonlist";


var refeshCount=0;

$.ajaxSetup({
    cache: false
});

function handleXML() {
  $.get(dataSource,
  function(xml){ 
	  parser = new DOMParser();
	  xmlDoc=parser.parseFromString(xml,"text/xml");
 
  	$('#content').html(ShowSalsaRuntime(xmlDoc)).fadeIn();
  	refeshCount+=1;
  	$('#counter').text(refeshCount).fadeIn();
  	
  	setTimeout(function(){
  		handleXML();
    }, 1000);
  	
  });
}

handleXML();

$.getJSON(listSource,  function(json){ 
	$('#list').html(createListTable(json.services)).fadeIn();
});

function ShowSalsaRuntime(data){ // data is CloudService
	var x=data.getElementsByTagName("component");
	var str="";
	for (var i = 0; i < x.length; i++) {
		str += '<b><big>Id: '+x[i].getAttribute('id')+'; Type:'+x[i].getAttribute('type')+'</big></b>';
		str += CreateTableViewSalsaReplicaNodeTable(x[i]);
	}
	return str;
}

function CreateTableViewSalsaReplicaNodeTable(data) {   // data is Component
    var str = '<table class="lightPro">';
      str += '<thead><tr>';
    // header row
     
     str += '<th scope="col"> Replica </th>';
     str += '<th scope="col"> State </th>';
     str += '<th scope="col"> Property </th>';
     str += '<th scope="col"> Capability </th>';
     
     str += '</tr></thead>';
    
     // table body
    str += '<tbody>';
    var x=data.getElementsByTagName("replicas");
    for (var i = 0; i < x.length; i++) {
    	
   		str += (i % 2 == 0) ? '<tr class="alt">' : '<tr>';
       	
       	str += '<td>' + x[i].getAttribute('replica') + '</td>';
       	str += '<td>' + x[i].getAttribute('state') + '</td>';
        	       	
        str += '<td>';
        var arrayCapa=x[i].getElementsByTagName("capability");
        //str+=arrayCapa.toString();
        for (var j=0; j<arrayCapa.length; j++){
        	str += arrayCapa[j].capaId+":"+arrayCapa[j].value+"; ";
        }        
        str+='</td>';
        
        str += '</tr>';        
    }
        
    str += '</tbody>'
    str += '</table><br/>';
    return str;
}

function createListTable(data){
	 var str = '<table class="lightPro">';
	 var currentURL= [location.protocol, '//', location.host, location.pathname].join('');
     str += '<thead><tr>';
    for (var index in data[0]) {
        str += '<th scope="col">' + index + '</th>';
    }
    str += '</tr></thead>';
   
    // table body
   str += '<tbody>';
   for (var i = 0; i < data.length; i++) {
          str += (i % 2 == 0) ? '<tr class="alt">' : '<tr>';
          str += '<td><a href="'+currentURL+'?id='+data[i].serviceId+'">' + data[i].serviceId + '</a></td>';
          str += '<td>' + data[i].deployTime + '</td>';
          str += '</tr>';
         
       }
   
       
   str += '</tbody>'
   str += '</table>';
   return str;
	
}

</script>


