<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<tosca:Definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:elasticity="http://www.example.org/NewXMLSchema" 
	xmlns:tosca="http://docs.oasis-open.org/tosca/ns/2011/12"
	xmlns:salsa="http://example.com"
	xsi:schemaLocation="http://docs.oasis-open.org/tosca/ns/2011/12 ../TOSCA-v1.0.xsd"
	targetNamespace="http://tempuri.org"
	id="DaaSApp">
	
	<tosca:ServiceTemplate id="IoTService">
		<tosca:TopologyTemplate>
			<!-- DESCRIBE MQTT BROKER -->
			<tosca:NodeTemplate id="mqtt_broker"
				name="agence" type="software"
				minInstances="1" maxInstances="1">		
				
				<tosca:Capabilities>
					<tosca:Capability name="IP of the broker" type="String" id="brokerIp_Capability"></tosca:Capability>
				</tosca:Capabilities>
				
				<tosca:DeploymentArtifacts>
					<tosca:DeploymentArtifact artifactType="sh" name="Chef for deploy broker" artifactRef="deployBroker"/>
				</tosca:DeploymentArtifacts>
			</tosca:NodeTemplate>			
			
			<tosca:NodeTemplate id="broker_os"
				name="broker os" type="os"
				minInstances="1" maxInstances="1">
				<tosca:Properties>
					<MappingProperties>		
						<MappingProperty type="os">
							<property name="instanceType">m1.small</property>
							<property name="provider">dsg@openstack</property> <!-- lal@stratuslab / dsg@openstack -->
							<property name="baseImage">ami-00000163</property> <!-- KBhcU87Wm5IZNOXZYGHrczGekwp / ami-00000163 -->
							<property name="packages">openjdk-7-jre</property> <!-- use comma between package -->
						</MappingProperty>
					</MappingProperties>
				</tosca:Properties>		
			</tosca:NodeTemplate>
			
			<tosca:RelationshipTemplate type="HOSTON" id="broker_on_os">
				<tosca:SourceElement ref="mqtt_broker"/>
				<tosca:TargetElement ref="broker_os"/>
			</tosca:RelationshipTemplate>
			
			<!-- DESCRIBE SENSOR, MQTT CLIENT -->
			<tosca:NodeTemplate id="sensor"
				name="agence" type="software"
				minInstances="1" maxInstances="unbounded">	
				<tosca:Requirements>
					<tosca:Requirement name="client need broker IP" type="String" id="brokerIp_Requirement"></tosca:Requirement>
				</tosca:Requirements>				
				<tosca:DeploymentArtifacts>
					<tosca:DeploymentArtifact artifactType="sh" name="Chef for deploy client" artifactRef="deployClient"/>
				</tosca:DeploymentArtifacts>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate id="sensor_os"
				name="client os" type="os"
				minInstances="1" maxInstances="unbounded">
				<tosca:Properties>
					<MappingProperties>		
						<MappingProperty type="os">
							<property name="instanceType">m1.small</property>
							<property name="provider">dsg@openstack</property> <!-- lal@stratuslab / dsg@openstack -->
							<property name="baseImage">ami-00000163</property> <!-- KBhcU87Wm5IZNOXZYGHrczGekwp / ami-00000163 -->
							<property name="packages">openjdk-7-jre</property> <!-- use comma between package -->
						</MappingProperty>
					</MappingProperties>
				</tosca:Properties>				
			</tosca:NodeTemplate>
			
			<tosca:RelationshipTemplate type="HOSTON" id="client_on_os">
				<tosca:SourceElement ref="sensor"/>
				<tosca:TargetElement ref="sensor_os"/>
			</tosca:RelationshipTemplate>
			
			<tosca:RelationshipTemplate type="CONNECTTO" id="sensor_to_broker">
				<tosca:SourceElement ref="brokerIp_Capability"/>
				<tosca:TargetElement ref="brokerIp_Requirement"/>
			</tosca:RelationshipTemplate>


<!-- DESCRIBE WEB APPLICATION -->				
		<tosca:NodeTemplate id="webapp"
				name="agence" type="software"
				minInstances="1" maxInstances="1">				
				<tosca:Requirements>
					<tosca:Requirement name="webapp needs broker IP" type="String" id="webapp_brokerIp_Requirement"></tosca:Requirement>
				</tosca:Requirements>				
				<tosca:DeploymentArtifacts>
					<tosca:DeploymentArtifact artifactType="sh" name="Chef for deploy webapp" artifactRef="deployWebapp"/>
				</tosca:DeploymentArtifacts>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate id="webapp_os"
				name="webapp os" type="os"
				minInstances="1" maxInstances="unbounded">
				<tosca:Properties>
					<MappingProperties>		
						<MappingProperty type="os">
							<property name="instanceType">m1.small</property>
							<property name="provider">dsg@openstack</property> <!-- lal@stratuslab / dsg@openstack -->
							<property name="baseImage">ami-00000163</property> <!-- KBhcU87Wm5IZNOXZYGHrczGekwp / ami-00000163 -->
							<property name="packages">openjdk-7-jre</property> <!-- use comma between package -->
						</MappingProperty>
					</MappingProperties>
				</tosca:Properties>				
			</tosca:NodeTemplate>
			
			<tosca:RelationshipTemplate type="HOSTON" id="webapp_on_os">
				<tosca:SourceElement ref="webapp"/>
				<tosca:TargetElement ref="webapp_os"/>
			</tosca:RelationshipTemplate>
			
			<tosca:RelationshipTemplate type="CONNECTTO" id="webapp_to_broker">
				<tosca:SourceElement ref="brokerIp_Capability"/>
				<tosca:TargetElement ref="webapp_brokerIp_Requirement"/>
			</tosca:RelationshipTemplate>	
			
		</tosca:TopologyTemplate>		
		
	</tosca:ServiceTemplate>
	
	<tosca:ArtifactTemplate id="deployClient" type="sh">		
		<tosca:ArtifactReferences>
			<tosca:ArtifactReference reference="http://128.130.172.215/salsa/upload/files/daas/fakescripts/donothing.sh" />		
		</tosca:ArtifactReferences>
	</tosca:ArtifactTemplate>
	
	<tosca:ArtifactTemplate id="deployBroker" type="sh">
		<tosca:ArtifactReferences>
			<tosca:ArtifactReference reference="http://128.130.172.215/salsa/upload/files/daas/fakescripts/donothing.sh" />				
		</tosca:ArtifactReferences>
	</tosca:ArtifactTemplate>

	<tosca:ArtifactTemplate id="deployWebapp" type="sh">
		<tosca:ArtifactReferences>
			<tosca:ArtifactReference reference="http://128.130.172.215/salsa/upload/files/daas/fakescripts/donothing.sh" />				
		</tosca:ArtifactReferences>
	</tosca:ArtifactTemplate>
	
</tosca:Definitions>
