<?xml version="1.0" encoding="UTF-8"?>
<tosca:Definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:elasticity="http://www.example.org/NewXMLSchema" 
	xmlns:tosca="http://docs.oasis-open.org/tosca/ns/2011/12"
	xmlns:salsa="http://example.com"
	xsi:schemaLocation="http://docs.oasis-open.org/tosca/ns/2011/12 TOSCA-v1.0.xsd"
	targetNamespace="http://tempuri.org"
	id="DaaSApp">
	
	<tosca:ServiceTemplate id="DaaSService">
		<tosca:documentation>
			This Tosca file describe the topology and deployment information for M2M_DaaS application.
			In order to use this file for deployment, deployment specific information need to be added.
			e.g to use it with SALSA tool, some SALSA specific information is need as nodes' property.
			In order to use this file for elastic control, elasticity specific need to be add, e.g in SYBL.
		</tosca:documentation>
		<tosca:TopologyTemplate>
		
<!-- DESCRIPTION FOR CASSANDRA CLUSTER -->
			<tosca:NodeTemplate id="CassandraHead"
				name="Cassandra head node" type="software"
				minInstances="1" maxInstances="1">
				<tosca:Capabilities>
					<tosca:Capability name="Data controller IP" type="variable" id="CassandraHeadIP_capa"></tosca:Capability>
				</tosca:Capabilities>
				<tosca:DeploymentArtifacts>
					<tosca:DeploymentArtifact artifactType="sh" name="Deployment script" artifactRef="deployCassandraHead"/>
				</tosca:DeploymentArtifacts>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate id="CassandraNode" name="Cassandra data node" type="software" minInstances="1" maxInstances="unbounded">			
				<tosca:Requirements>
					<tosca:Requirement name="Connect to data controller" type="variable" id="CassandraHeadIP_req"></tosca:Requirement>
				</tosca:Requirements>				
				<tosca:DeploymentArtifacts>
					<tosca:DeploymentArtifact artifactType="sh" name="Deployment script" artifactRef="deployCassandraNode"/>
				</tosca:DeploymentArtifacts>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate type="os" id="OS_HeadNode">
				 <tosca:Properties>
                    <MappingProperties>						
						<ElasticityPreferences type="os">
							<Resources>
								<Resource name="cpu" from="1" to="4"/>
								<Resource name="memory" from="1024" to="8192"/>
							</Resources>
							<Qualities>
								<Quality name="amplitude">0</Quality>
								<Quality name="frequency">0</Quality>
							</Qualities>
							<Costs>
								<Cost name="from">0.5</Cost>
								<Cost name="to">1.0</Cost>
							</Costs>					
						</ElasticityPreferences>
					</MappingProperties>
                </tosca:Properties>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate type="os" id="OS_Datanode">
				 <tosca:Properties>
                    <MappingProperties>						
						<ElasticityPreferences type="os">
							<Resources>
								<Resource name="cpu" from="1" to="4"/>
								<Resource name="memory" from="1024" to="8192"/>
							</Resources>
							<Qualities>
								<Quality name="amplitude">2</Quality>
								<Quality name="frequency">3</Quality>
							</Qualities>
							<Costs>
								<Cost name="from">0.5</Cost>
								<Cost name="to">1.0</Cost>
							</Costs>					
						</ElasticityPreferences>
					</MappingProperties>
                </tosca:Properties>
			</tosca:NodeTemplate>

			<tosca:RelationshipTemplate name="Relation" type="CONNECTTO" id="head2datanode">
				<tosca:SourceElement ref="CassandraHeadIP_capa"/>
				<tosca:TargetElement ref="CassandraHeadIP_req"/>
			</tosca:RelationshipTemplate>						
			<tosca:RelationshipTemplate name="Relation" type="HOSTON" id="data2os">
				<tosca:SourceElement ref="CassandraHead"/>
				<tosca:TargetElement ref="OS_HeadNode" />
			</tosca:RelationshipTemplate>
			<tosca:RelationshipTemplate name="Relation" type="HOSTON" id="controller2os">
				<tosca:SourceElement ref="CassandraNode"/>
				<tosca:TargetElement ref="OS_Datanode" />
			</tosca:RelationshipTemplate>	


<!-- DESCRIBE WEB SERVICE -->
			<tosca:NodeTemplate id="LoadBalancer" type="software" name="Load Balancer">
				<tosca:Capabilities>
					<tosca:Capability name="Load balancer IP" type="variable" id="LoadBalancerIP_capa"></tosca:Capability>
				</tosca:Capabilities>
				<tosca:DeploymentArtifacts>				
                    <tosca:DeploymentArtifact name="deploy" artifactType="sh" artifactRef="deployLoadBalancer"/>                
				</tosca:DeploymentArtifacts>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate id="EventProcessing" type="software" name="Event Processing">
				<tosca:Requirements>
					<tosca:Requirement name="Get Load balancer IP" type="variable" id="LoadBalancerIp_req"></tosca:Requirement>
					<tosca:Requirement name="Get Cassandra headnode IP" type="variable" id="CassandraHeadIp_req2"></tosca:Requirement>
				</tosca:Requirements>				
				<tosca:DeploymentArtifacts>				
                    <tosca:DeploymentArtifact name="deploy" artifactType="sh" artifactRef="tosca:deployEventProcessing"/>                
				</tosca:DeploymentArtifacts>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate type="os" id="OS_LoadBalancer">			
				 <tosca:Properties>
                    <MappingProperties>						
						<ElasticityPreferences type="os">
							<Resources>
								<Resource name="cpu" from="2" to="4"/>
								<Resource name="memory" from="2048" to="8192"/>
							</Resources>
							<Qualities>
								<Quality name="amplitude">0</Quality>
								<Quality name="frequency">0</Quality>
							</Qualities>
							<Costs>
								<Cost name="from">0.5</Cost>
								<Cost name="to">1.0</Cost>
							</Costs>					
						</ElasticityPreferences>	
					</MappingProperties>
                </tosca:Properties>
			</tosca:NodeTemplate>
			
			<tosca:NodeTemplate type="os" id="OS_EventProcessing">
				 <tosca:Properties>
                    <MappingProperties>						
						<ElasticityPreferences type="os">
							<Resources>
								<Resource name="cpu" from="1" to="4"/>
								<Resource name="memory" from="1024" to="8192"/>
							</Resources>
							<Qualities>
								<Quality name="amplitude">2</Quality>
								<Quality name="frequency">2</Quality>
							</Qualities>
							<Costs>
								<Cost name="from">0.5</Cost>
								<Cost name="to">1.0</Cost>
							</Costs>					
						</ElasticityPreferences> 

					</MappingProperties>
                </tosca:Properties>
			</tosca:NodeTemplate>
			
			<tosca:RelationshipTemplate name="Relation" type="CONNECTTO" id="loadbalancer2EventProcessing">
				<tosca:Properties>
					<ConnecToProperty type="internal"></ConnecToProperty>
				</tosca:Properties>				
				<tosca:SourceElement ref="LoadBalancerIP_capa" />
				<tosca:TargetElement ref="LoadBalancerIp_req" />
			</tosca:RelationshipTemplate>
			
			<tosca:RelationshipTemplate type="HOSTON" id="loadbalancer2os" >							
				<tosca:SourceElement ref="LoadBalancer"/>
				<tosca:TargetElement ref="OS_LoadBalancer" />
			</tosca:RelationshipTemplate>
			
			<tosca:RelationshipTemplate type="HOSTON" id="eventprocessing2os">
				<tosca:SourceElement ref="EventProcessing"/>
				<tosca:TargetElement ref="OS_EventProcessing" />
			</tosca:RelationshipTemplate>
			
<!-- RELATIONSHIP BETWEEN WEB SERVICE AND CASSANDRA-HEAD -->
			<tosca:RelationshipTemplate name="Relation" type="CONNECTTO" id="EventProcessing2CassandraHead">
				<tosca:SourceElement ref="CassandraHeadIP_capa" />
				<tosca:TargetElement ref="CassandraHeadIp_req2" />
			</tosca:RelationshipTemplate>
									
		</tosca:TopologyTemplate>
	</tosca:ServiceTemplate>
	
<!-- DEPLOYMENT ARTIFACTS DESCRIPTION -->
	<tosca:ArtifactTemplate id="deployCassandraHead" type="sh">
        <tosca:ArtifactReferences>
            <tosca:ArtifactReference reference="URL to the artifact"/>
        </tosca:ArtifactReferences>
    </tosca:ArtifactTemplate>
    
    <tosca:ArtifactTemplate id="deployCassandraNode" type="sh">       
        <tosca:ArtifactReferences>
            <tosca:ArtifactReference reference="URL to the artifact"/>
        </tosca:ArtifactReferences>
    </tosca:ArtifactTemplate>
    
    <tosca:ArtifactTemplate id="deployLoadBalancer" type="sh">       
        <tosca:ArtifactReferences>
            <tosca:ArtifactReference reference="URL to the artifact"/>
        </tosca:ArtifactReferences>
    </tosca:ArtifactTemplate>
    
    <tosca:ArtifactTemplate id="deployEventProcessing" type="sh">       
        <tosca:ArtifactReferences>
            <tosca:ArtifactReference reference="URL to the artifact"/>
        </tosca:ArtifactReferences>
    </tosca:ArtifactTemplate>	
	
</tosca:Definitions>
